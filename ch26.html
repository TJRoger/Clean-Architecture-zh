<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chap26. THE MAIN COMPONENT Main 组件 | Clean Architecture 中文</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/Clean-Architecture-zh/assets/css/0.styles.0e927437.css" as="style"><link rel="preload" href="/Clean-Architecture-zh/assets/js/app.e5effdf8.js" as="script"><link rel="preload" href="/Clean-Architecture-zh/assets/js/2.bf9c5374.js" as="script"><link rel="preload" href="/Clean-Architecture-zh/assets/js/26.48daeeee.js" as="script"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/10.72b1d5a8.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/11.85ace757.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/12.ba72c67f.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/13.1ad28e3b.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/14.abf9e015.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/15.f8bcae3e.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/16.2e5a9a21.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/17.b984cafb.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/18.149b6ba6.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/19.f83be286.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/20.0536528d.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/21.30ec93ba.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/22.1fa929f0.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/23.05888d20.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/24.3f945251.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/25.1ea51614.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/27.40e09638.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/28.6cea37ed.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/29.989d1449.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/3.6162eedb.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/30.222fd292.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/31.ef675510.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/32.bb68e92f.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/33.9e94c78c.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/34.8655a016.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/35.5ecacd2f.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/36.216745ea.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/37.d926244a.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/38.a9031a9a.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/39.8afae9d5.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/4.1c6c1538.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/40.15029a92.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/41.1a38a27b.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/42.d5be146c.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/43.92036d5b.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/44.bbd89904.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/45.241dd224.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/46.182041c0.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/47.affdb4e1.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/48.50a782c0.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/49.af18f515.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/5.2562db0f.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/6.d515cbe9.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/7.7f0c5d21.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/8.bc63b05c.js"><link rel="prefetch" href="/Clean-Architecture-zh/assets/js/9.9fe96186.js">
    <link rel="stylesheet" href="/Clean-Architecture-zh/assets/css/0.styles.0e927437.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Clean-Architecture-zh/" class="home-link router-link-active"><!----> <span class="site-name">Clean Architecture 中文</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/tjroger/Clean-Architecture-zh" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/tjroger/Clean-Architecture-zh" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/Clean-Architecture-zh/" aria-current="page" class="sidebar-link">Clean Architecture 中文</a></li><li><a href="/Clean-Architecture-zh/part1.html" class="sidebar-link">Part1. INTRODUCTION 概述</a></li><li><a href="/Clean-Architecture-zh/ch1.html" class="sidebar-link">Chap1. WHAT IS DESIGN AND ARCHITECTURE? 设计与架构到底是什么</a></li><li><a href="/Clean-Architecture-zh/ch2.html" class="sidebar-link">Chap2. A TALE OF TWO VALUES 两个价值维度</a></li><li><a href="/Clean-Architecture-zh/part2.html" class="sidebar-link">Part2. STARTING WITH THE BRICKS: PROGRAMMING PARADIGMS 从基础构件开始：编程范式</a></li><li><a href="/Clean-Architecture-zh/ch3.html" class="sidebar-link">Chap3. PARADIGM OVERVIEW 编程范式总览</a></li><li><a href="/Clean-Architecture-zh/ch4.html" class="sidebar-link">Chap4. STRUCTURED PROGRAMMING 结构化编程</a></li><li><a href="/Clean-Architecture-zh/ch5.html" class="sidebar-link">Chap5. OBJECT-ORIENTED PROGRAMMING 面向对象编程</a></li><li><a href="/Clean-Architecture-zh/ch6.html" class="sidebar-link">Chap6. FUNCTIONAL PROGRAMMING 函数式编程</a></li><li><a href="/Clean-Architecture-zh/part3.html" class="sidebar-link">Part3. DESIGN PRINCIPLES 设计原则</a></li><li><a href="/Clean-Architecture-zh/ch7.html" class="sidebar-link">Chap7. SRP: THE SINGLE RESPONSIBILITY PRINCIPLE SRP：单一职责原则</a></li><li><a href="/Clean-Architecture-zh/ch8.html" class="sidebar-link">Chap8. OCP: THE OPEN-CLOSED PRINCIPLE OCP：开闭原则</a></li><li><a href="/Clean-Architecture-zh/ch9.html" class="sidebar-link">Chap9. LSP: THE LISKOV SUBSTITUTION PRINCIPLE LSP：里氏替换原则</a></li><li><a href="/Clean-Architecture-zh/ch10.html" class="sidebar-link">Chap10. ISP: THE INTERFACE SEGREGATION PRINCIPLE ISP：接口隔离原则</a></li><li><a href="/Clean-Architecture-zh/ch11.html" class="sidebar-link">Chap11. DIP: THE DEPENDENCY INVERSION PRINCIPLE DIP：依赖反转原则</a></li><li><a href="/Clean-Architecture-zh/part4.html" class="sidebar-link">Part4. COMPONENT PRINCIPLES 组件构建原则</a></li><li><a href="/Clean-Architecture-zh/ch12.html" class="sidebar-link">Chap12. COMPONENTS 组件</a></li><li><a href="/Clean-Architecture-zh/ch13.html" class="sidebar-link">Chap13. COMPONENT COHESION 组件聚合</a></li><li><a href="/Clean-Architecture-zh/ch14.html" class="sidebar-link">Chap14. COMPONENT COUPLING 组件耦合</a></li><li><a href="/Clean-Architecture-zh/part5.html" class="sidebar-link">Part5. ARCHITECTURE 软件架构</a></li><li><a href="/Clean-Architecture-zh/ch15.html" class="sidebar-link">Chap15. WHAT IS ARCHITECTURE? 什么是软件架构</a></li><li><a href="/Clean-Architecture-zh/ch16.html" class="sidebar-link">Chap16. INDEPENDENCE 独立性</a></li><li><a href="/Clean-Architecture-zh/ch17.html" class="sidebar-link">Chap17. BOUNDARIES: DRAWING LINES 划分边界</a></li><li><a href="/Clean-Architecture-zh/ch18.html" class="sidebar-link">Chap18. BOUNDARY ANATOMY 边界剖析</a></li><li><a href="/Clean-Architecture-zh/ch19.html" class="sidebar-link">Chap19. POLICY AND LEVEL 策略与层次</a></li><li><a href="/Clean-Architecture-zh/ch20.html" class="sidebar-link">Chap20. BUSINESS RULES 业务逻辑</a></li><li><a href="/Clean-Architecture-zh/ch21.html" class="sidebar-link">Chap21. SCREAMING ARCHITECTURE 尖叫的软件架构</a></li><li><a href="/Clean-Architecture-zh/ch22.html" class="sidebar-link">Chap22. THE CLEAN ARCHITECTURE 整洁架构</a></li><li><a href="/Clean-Architecture-zh/ch23.html" class="sidebar-link">Chap23. PRESENTERS AND HUMBLE OBJECTS 展示器和精简对象</a></li><li><a href="/Clean-Architecture-zh/ch24.html" class="sidebar-link">Chap24. PARTIAL BOUNDARIES 不完全边界</a></li><li><a href="/Clean-Architecture-zh/ch25.html" class="sidebar-link">Chap25. LAYERS AND BOUNDARIES 层次与边界</a></li><li><a href="/Clean-Architecture-zh/ch26.html" aria-current="page" class="active sidebar-link">Chap26. THE MAIN COMPONENT Main 组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Clean-Architecture-zh/ch26.html#the-ultimate-detail-最细节化的部分" class="sidebar-link">THE ULTIMATE DETAIL 最细节化的部分</a></li><li class="sidebar-sub-header"><a href="/Clean-Architecture-zh/ch26.html#conclusion-本章小结" class="sidebar-link">CONCLUSION 本章小结</a></li></ul></li><li><a href="/Clean-Architecture-zh/ch27.html" class="sidebar-link">Chap27. SERVICES: GREAT AND SMALL 服务：宏观与微观</a></li><li><a href="/Clean-Architecture-zh/ch28.html" class="sidebar-link">Chap28. THE TEST BOUNDARY 测试边界</a></li><li><a href="/Clean-Architecture-zh/ch29.html" class="sidebar-link">Chap29. CLEAN EMBEDDED ARCHITECTURE 整洁的嵌入式架构</a></li><li><a href="/Clean-Architecture-zh/part6.html" class="sidebar-link">Part6. DETAILS 实现细节</a></li><li><a href="/Clean-Architecture-zh/ch30.html" class="sidebar-link">Chap30. THE DATABASE IS A DETAIL 数据库只是实现细节</a></li><li><a href="/Clean-Architecture-zh/ch31.html" class="sidebar-link">Chap31. THE WEB IS A DETAIL Web 是实现细节</a></li><li><a href="/Clean-Architecture-zh/ch32.html" class="sidebar-link">Chap32. FRAMEWORKS ARE DETAILS 应用程序框架是实现细节</a></li><li><a href="/Clean-Architecture-zh/ch33.html" class="sidebar-link">Chap33. CASE STUDY: VIDEO SALES 案例分析：视频销售网站</a></li><li><a href="/Clean-Architecture-zh/ch34.html" class="sidebar-link">Chap34. THE MISSING CHAPTER 拾遗</a></li><li><a href="/Clean-Architecture-zh/afterword.html" class="sidebar-link">AFTERWORD 后序</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chap26-the-main-component-main-组件"><a href="#chap26-the-main-component-main-组件" class="header-anchor">#</a> Chap26. THE MAIN COMPONENT Main 组件</h1> <p><img src="/Clean-Architecture-zh/assets/img/CH-UN26.eb92c871.jpg" alt=""></p> <p>In every system, there is at least one component that creates, coordinates, and oversees the others. I call this component Main.</p> <blockquote><p>在所有的系统中，都至少要有一个组件来负责创建、协调、监督其他组件的运转。我们将其称为 Main 组件。</p></blockquote> <h2 id="the-ultimate-detail-最细节化的部分"><a href="#the-ultimate-detail-最细节化的部分" class="header-anchor">#</a> THE ULTIMATE DETAIL 最细节化的部分</h2> <p>The Main component is the ultimate detail—the lowest-level policy. It is the initial entry point of the system. Nothing, other than the operating system, depends on it. Its job is to create all the Factories, Strategies, and other global facilities, and then hand control over to the high-level abstract portions of the system.</p> <blockquote><p>Main 组件是系统中最细节化的部分——也就是底层的策略，它是整个系统的初始点。在整个系统中，除了操作系统不会再有其他组件依赖于它了。Main 组件的任务是创建所有的工厂类、策略类以及其他的全局设施，并最终将系统的控制权转交给最高抽象层的代码来处理。</p></blockquote> <p>It is in this Main component that dependencies should be injected by a Dependency Injection framework. Once they are injected into Main, Main should distribute those dependencies normally, without using the framework.</p> <blockquote><p>Main 组件中的依赖关系通常应该由依赖注入框架来注入。在该框架将依赖关系注入到 Main 组件之后，Main 组件就应该可以在不依赖于该框架的情况下自行分配这些依赖关系了。</p></blockquote> <p>Think of Main as the dirtiest of all the dirty components.</p> <blockquote><p>请记住，Main 组件是整个系统中细节信息最多的组件。</p></blockquote> <p>Consider the following Main component from a recent version of Hunt the Wumpus. Notice how it loads up all the strings that we don’t want the main body of the code to know about.</p> <blockquote><p>下面，我们来看一下最新版 Hunt the Wumpus 游戏的 Main 组件。请注意这里加载字符串的方法，这些字符串全都是我们不想让游戏主体代码了解的内容。</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token keyword">implements</span> <span class="token class-name">HtwMessageReceiver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HuntTheWumpus</span> game<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> hitPoints <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> caverns <span class="token operator">=</span> <span class="token keyword">new</span>   <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> environments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
    <span class="token string">&quot;bright&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;humid&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dry&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;creepy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ugly&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;foggy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;hot&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;cold&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;drafty&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dreadful&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> shapes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;round&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;square&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;oval&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;irregular&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;long&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;craggy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;rough&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;tall&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;narrow&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cavernTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;cavern&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;room&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;chamber&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;catacomb&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;crevasse&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;cell&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;tunnel&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;passageway&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;hall&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;expanse&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> adornments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
   <span class="token string">&quot;smelling of sulfur&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;with engravings on the walls&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;with a bumpy floor&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;littered with garbage&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;spattered with guano&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;with piles of Wumpus droppings&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;with bones scattered around&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;with a corpse on the floor&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;that seems to vibrate&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;that feels stuffy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;that fills you with dread&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Now here’s the main function. Notice how it uses the HtwFactory to create the game. It passes in the name of the class, htw.game.HuntTheWumpusFacade, because that class is even dirtier than Main. This prevents changes in that class from causing Main to recompile/redeploy.</p> <blockquote><p>接下来是 main 函数。请注意这里是如何使用 HtwFactory 来构建这个游戏的。我们可以看到这里传入了 一个名为 <code>htw.game.HuntTheWumpusFacade</code> 的类。由于这个类中的细节信息比 Main 组件还多，变更也更频繁，因此这样做可以避免这个类的变更导致 Main 组件的重新编译和重新部署。</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
   game <span class="token operator">=</span> <span class="token class-name">HtwFactory</span><span class="token punctuation">.</span><span class="token function">makeGame</span><span class="token punctuation">(</span><span class="token string">&quot;htw.game.HuntTheWumpusFacade&quot;</span><span class="token punctuation">,</span>
                                 <span class="token keyword">new</span> <span class="token class-name">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">createMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span>
     <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   game<span class="token punctuation">.</span><span class="token function">makeRestCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">getPlayerCavern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Health: &quot;</span> <span class="token operator">+</span> hitPoints <span class="token operator">+</span> <span class="token string">&quot; arrows: &quot;</span> <span class="token operator">+</span>
                           game<span class="token punctuation">.</span><span class="token function">getQuiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">HuntTheWumpus<span class="token punctuation">.</span>Command</span> c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeRestCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">String</span> command <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeMoveCommand</span><span class="token punctuation">(</span>EAST<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeMoveCommand</span><span class="token punctuation">(</span>WEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeMoveCommand</span><span class="token punctuation">(</span>NORTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeMoveCommand</span><span class="token punctuation">(</span>SOUTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeRestCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;sw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeShootCommand</span><span class="token punctuation">(</span>WEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;se&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeShootCommand</span><span class="token punctuation">(</span>EAST<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;sn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeShootCommand</span><span class="token punctuation">(</span>NORTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">makeShootCommand</span><span class="token punctuation">(</span>SOUTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

      c<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>Notice also that main creates the input stream and contains the main loop of the game, interpreting the simple input commands, but then defers all processing to other, higher-level components.</p> <blockquote><p>你还应该注意到 main 函数中创建了输入数据流，并纳入了游戏的主循环。主循环将负责处理简单的输入指令，但它会将具体的处理过程交给其他更高层次的组件来处理。</p></blockquote> <p>Finally, notice that main creates the map.</p> <blockquote><p>最后，Main 组件还要负责生成整个游戏的地图。</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> nCaverns <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30.0</span> <span class="token operator">+</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span>nCaverns<span class="token operator">--</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
     caverns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">makeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> cavern <span class="token operator">:</span> caverns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">maybeConnectCavern</span><span class="token punctuation">(</span>cavern<span class="token punctuation">,</span> NORTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">maybeConnectCavern</span><span class="token punctuation">(</span>cavern<span class="token punctuation">,</span> SOUTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">maybeConnectCavern</span><span class="token punctuation">(</span>cavern<span class="token punctuation">,</span> EAST<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">maybeConnectCavern</span><span class="token punctuation">(</span>cavern<span class="token punctuation">,</span> WEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> playerCavern <span class="token operator">=</span> <span class="token function">anyCavern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    game<span class="token punctuation">.</span><span class="token function">setPlayerCavern</span><span class="token punctuation">(</span>playerCavern<span class="token punctuation">)</span><span class="token punctuation">;</span>
    game<span class="token punctuation">.</span><span class="token function">setWumpusCavern</span><span class="token punctuation">(</span><span class="token function">anyOther</span><span class="token punctuation">(</span>playerCavern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    game<span class="token punctuation">.</span><span class="token function">addBatCavern</span><span class="token punctuation">(</span><span class="token function">anyOther</span><span class="token punctuation">(</span>playerCavern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    game<span class="token punctuation">.</span><span class="token function">addBatCavern</span><span class="token punctuation">(</span><span class="token function">anyOther</span><span class="token punctuation">(</span>playerCavern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    game<span class="token punctuation">.</span><span class="token function">addBatCavern</span><span class="token punctuation">(</span><span class="token function">anyOther</span><span class="token punctuation">(</span>playerCavern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    game<span class="token punctuation">.</span><span class="token function">addPitCavern</span><span class="token punctuation">(</span><span class="token function">anyOther</span><span class="token punctuation">(</span>playerCavern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    game<span class="token punctuation">.</span><span class="token function">addPitCavern</span><span class="token punctuation">(</span><span class="token function">anyOther</span><span class="token punctuation">(</span>playerCavern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    game<span class="token punctuation">.</span><span class="token function">addPitCavern</span><span class="token punctuation">(</span><span class="token function">anyOther</span><span class="token punctuation">(</span>playerCavern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    game<span class="token punctuation">.</span><span class="token function">setQuiver</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// much code removed…</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The point is that Main is a dirty low-level module in the outermost circle of the clean architecture. It loads everything up for the high level system, and then hands control over to it.</p> <blockquote><p>我们在这里的重点是要说明 Main 组件是整个系统中的一个底层模块，它处于整洁架构的最外圈，主要负责为系统加载所有必要的信息，然后再将控制权转交回系统的高层组件。</p></blockquote> <h2 id="conclusion-本章小结"><a href="#conclusion-本章小结" class="header-anchor">#</a> CONCLUSION 本章小结</h2> <p>Think of Main as a plugin to the application—a plugin that sets up the initial conditions and configurations, gathers all the outside resources, and then hands control over to the high-level policy of the application. Since it is a plugin, it is possible to have many Main components, one for each configuration of your application.</p> <blockquote><p>Main 组件也可以被视为应用程序的一个插件——这个插件负责设置起始状态、配置信息、加载外部资源，最后将控制权转交给应用程序的其他高层组件。另外，由于 Main 组件能以插件形式存在于系统中，因此我们可以为一个系统设计多个 Main 组件，让它们各自对应于不同的配置。</p></blockquote> <p>For example, you could have a Main plugin for Dev, another for Test, and yet another for Production. You could also have a Main plugin for each country you deploy to, or each jurisdiction, or each customer.</p> <blockquote><p>例如，我们既可以设计专门针对开发环境的 Main 组件，也可以设计专门针对测试的或者生产环境的 Main 组件。除此之外，我们还可以针对要部署的国家、地区甚至客户设计不同的 Main 组件。</p></blockquote> <p>When you think about Main as a plugin component, sitting behind an architectural boundary, the problem of configuration becomes a lot easier to solve.</p> <blockquote><p>当我们将 Main 组件视为一种插件时，用架构边界将它与系统其他部分隔离开这件事，在系统的配置上是不是就变得更容易了呢？</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/tjroger/Clean-Architecture-zh/edit/master/docs/ch26.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/14/2025, 7:41:40 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Clean-Architecture-zh/ch25.html" class="prev">
        Chap25. LAYERS AND BOUNDARIES 层次与边界
      </a></span> <span class="next"><a href="/Clean-Architecture-zh/ch27.html">
        Chap27. SERVICES: GREAT AND SMALL 服务：宏观与微观
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Clean-Architecture-zh/assets/js/app.e5effdf8.js" defer></script><script src="/Clean-Architecture-zh/assets/js/2.bf9c5374.js" defer></script><script src="/Clean-Architecture-zh/assets/js/26.48daeeee.js" defer></script>
  </body>
</html>
